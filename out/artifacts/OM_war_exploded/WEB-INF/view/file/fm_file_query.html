<#include "../../head.html" >


<script type="text/javascript">

	$(function() {
		 var fm_query_form = $("#fm_query_form").ligerForm({
        	inputWidth : 150,
        	labelWidth : 100,
            fields: [{
            		display: "订单编号",
            		name: "salesOrderId",
            		newline: true,
            		type: "combobox",
            		options : {
    					valueField : 'salesOrderId',
    					textField : 'orderNumber',
    					url : _basePath + "/om/selectAllOrders",
    					isMultiSelect : false,
    					isShowCheckBox : false,
    					//autocomplete : true
                    },
            	},{
            		display: "文件名",
            		name: "fileName",
            		newline: false,
            		type: "text"
            	}],
            	buttons : [ {
                    text : '查询',
                    width : 60,
                    click : function() {
                    	BaseCommonUI.formToGridQuery(fm_query_form, fm_query_grid);
                    }
                }]
        	});
		 
		 var fm_query_grid = window['fm_query_grid'] = $("#fm_query_grid").ligerGrid({
				title : '查询结果',
	            height : '100%',
				usePager : true,
				checkbox : false,
				delayLoad : false,
	            url : '${base.contextPath}/file/queryFileOperate',
				columns : [{
					display : '订单编号',
					name : 'salesOrderId',
					textField : 'orderNumber',
					align : 'center'
				},{
					display : '文件名',
					name : 'fileName',
					align : 'center'
				},{
					display : '文件路径',
					name : 'filePath',
					align : 'center',
					render : function(item) {
						var path = "${base.contextPath}/file/downloadFile?fileId="+item.fileId;
						return '<a href='+path+'>'+item.filePath+'</a>';
					}
				}],
				toolbar : {
					items : [{
						id : 'om_order_add',
						text : '上传文件',
						click : function() {
							$.ligerDialog.open({
								title : '上传文件',
								url : 'fm_file_upload.html',
						        width : 500,
						        height : 280,
						        buttons: [{
						        	text: '取消', 
						        	onclick: function (item, dialog) {
						        		dialog.hide();
						        	}
						        }]
						    });
						},
						icon : 'add'
					},
					{ line: true },
					{
						id : 'om_order_delete',
						text : '删除',
						click : function() {
							//TODO 删除文件
							var selected = fm_query_grid.getSelectedRow();
							if (selected == null) {
								$.ligerDialog.error("请先选择行")
								return false;
							}
							$.ligerDialog.confirm("确认删除？", function(yes) {
								if (yes) {
									$.ajax({
										url : _basePath + '/file/deleteByFileId?fileId='+selected.fileId,
										type : 'POST',
										dataType : 'json',
										contentType : 'application/json',
										success : function(resdata) {
											fm_query_grid.reload();
										}
									});
									return true;
								} else {
									return false;
								}
							});
						},
						icon : 'delete'
					}]
				}
			});
	});
	
</script>


<body>
	<div>
		<form id="fm_query_form"></form>
		<div id="fm_query_grid" style="margin-top: 10px" ></div>
	</div>
</body>
